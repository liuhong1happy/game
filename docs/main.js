(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{100:
/*!**********************************!*\
  !*** ./src/scenes/home/index.js ***!
  \**********************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,i){"use strict";var n=i(/*! @babel/runtime/helpers/interopRequireDefault */1);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i(/*! @babel/runtime/core-js/object/get-prototype-of */38)),s=n(i(/*! @babel/runtime/helpers/classCallCheck */3)),a=n(i(/*! @babel/runtime/helpers/createClass */2)),r=n(i(/*! @babel/runtime/helpers/possibleConstructorReturn */32)),u=n(i(/*! @babel/runtime/helpers/inherits */22)),l=function(t){function e(){return(0,s.default)(this,e),(0,r.default)(this,(e.__proto__||(0,o.default)(e)).apply(this,arguments))}return(0,u.default)(e,t),(0,a.default)(e,[{key:"Start",value:function(){}},{key:"Update",value:function(){}},{key:"End",value:function(){}}]),e}(n(i(/*! ../scene */16)).default);e.default=l},101:
/*!***********************!*\
  !*** ./src/router.js ***!
  \***********************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,i){"use strict";var n=i(/*! @babel/runtime/helpers/interopRequireDefault */1);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i(/*! ./scenes/home/index */100)),s=n(i(/*! ./scenes/loading/index */59)),a=n(i(/*! ./scenes/play/index */58)),r=n(i(/*! ./scenes/scene */16)),u={"/home":new o.default,"/loading":new s.default,"/play":new a.default,"/404":new r.default}["/play"];e.default=u},106:
/*!*******************************!*\
  !*** ./src/styles/index.less ***!
  \*******************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,i){var n=i(/*! !../../node_modules/css-loader!../../node_modules/less-loader/dist/cjs.js!./index.less */20);"string"==typeof n&&(n=[[t.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0},s=i(/*! ../../node_modules/style-loader/lib/addStyles.js */104)(n,o);n.locals&&(t.exports=n.locals),t.hot.accept(/*! !../../node_modules/css-loader!../../node_modules/less-loader/dist/cjs.js!./index.less */20,function(e){!function(){var e=i(/*! !../../node_modules/css-loader!../../node_modules/less-loader/dist/cjs.js!./index.less */20);if("string"==typeof e&&(e=[[t.i,e,""]]),!function(t,e){var i,n=0;for(i in t){if(!e||t[i]!==e[i])return!1;n++}for(i in e)n--;return 0===n}(n.locals,e.locals))throw new Error("Aborting CSS HMR due to changed css-modules locals.");s(e)}()}),t.hot.dispose(function(){s()})},107:
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,i){"use strict";i(/*! ./styles/index.less */106),window.THREE=i(/*! three */102);var n,o=i(/*! ./router */101).default;(n=new THREE.WebGLRenderer({antialias:!0})).setSize(window.innerWidth,window.innerHeight),document.body.appendChild(n.domElement),o.Init(n),function t(){requestAnimationFrame(t),o.Render()}()},15:
/*!**************************************!*\
  !*** ./src/scripts/models/player.js ***!
  \**************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n={direction:"w",position:{x:0,y:0}};e.default=n},16:
/*!*****************************!*\
  !*** ./src/scenes/scene.js ***!
  \*****************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,i){"use strict";var n=i(/*! @babel/runtime/helpers/interopRequireDefault */1);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i(/*! @babel/runtime/helpers/classCallCheck */3)),s=n(i(/*! @babel/runtime/helpers/createClass */2)),a=function(){function t(){(0,o.default)(this,t),this.camera=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.01,10),this.scene=new THREE.Scene}return(0,s.default)(t,[{key:"Init",value:function(t){this.renderer=t,this.renderer.setSize(window.innerWidth,window.innerHeight),window.addEventListener("resize",this.onWindowResize,!1),this.Start(t)}},{key:"Start",value:function(){}},{key:"Render",value:function(){this.Update(),this.renderer.render(this.scene,this.camera)}},{key:"Update",value:function(){}},{key:"Unload",value:function(){window.removeEventListener("resize",this.onWindowResize,!1),this.End()}},{key:"End",value:function(){}},{key:"onWindowResize",value:function(){this.renderer&&(this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight))}}]),t}();e.default=a},20:
/*!************************************************************************************************!*\
  !*** ./node_modules/css-loader!./node_modules/less-loader/dist/cjs.js!./src/styles/index.less ***!
  \************************************************************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,i){(t.exports=i(/*! ../../node_modules/css-loader/lib/css-base.js */105)(!1)).push([t.i,"body {\n  font-family: Monospace;\n  background-color: #000;\n  color: #000;\n  margin: 0px;\n  overflow: hidden;\n}\n",""])},21:
/*!*************************************!*\
  !*** ./src/scripts/consts/index.js ***!
  \*************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;e.default={direction:{w:{x:0,y:1},s:{x:0,y:-1},a:{x:-1,y:0},d:{x:1,y:0}},gridCount:200,enemyV:.005,playerV:.012,playerSize:.7}},54:
/*!******************************************************!*\
  !*** ./src/scripts/controllers/GestureController.js ***!
  \******************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,i){"use strict";var n=i(/*! @babel/runtime/helpers/interopRequireDefault */1);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i(/*! @babel/runtime/core-js/object/keys */53)),s=n(i(/*! @babel/runtime/helpers/classCallCheck */3)),a=n(i(/*! @babel/runtime/helpers/createClass */2)),r={d:[0,90],w:[90,180],a:[-180,-90],s:[-90,0]},u=function(){function t(){(0,s.default)(this,t),this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.direction="c"}return(0,a.default)(t,[{key:"init",value:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),window.addEventListener("touchstart",this.onTouchStart),window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("touchend",this.onTouchEnd)}},{key:"unload",value:function(){window.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd)}},{key:"onTouchStart",value:function(t){t.preventDefault(),this.startX=t.touches[0].pageX,this.startY=t.touches[0].pageY}},{key:"GetSlideAngle",value:function(t,e){return 180*Math.atan2(e,t)/Math.PI}},{key:"GetSlideDirection",value:function(){var t=this.startY-this.endY,e=this.endX-this.startX;if(Math.abs(e)<2&&Math.abs(t)<2)return null;var i=this.GetSlideAngle(e,t),n="c";return(0,o.default)(r).forEach(function(t){i>=r[t][0]&&i<=r[t][1]&&(n=t)}),n}},{key:"onTouchMove",value:function(t){t.preventDefault(),this.endX=t.changedTouches[0].pageX,this.endY=t.changedTouches[0].pageY}},{key:"onTouchEnd",value:function(t){t.preventDefault(),this.direction=this.GetSlideDirection()}}]),t}();e.default=u},55:
/*!****************************************************!*\
  !*** ./src/scripts/controllers/EnemyController.js ***!
  \****************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,i){"use strict";var n=i(/*! @babel/runtime/helpers/interopRequireDefault */1);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i(/*! @babel/runtime/helpers/classCallCheck */3)),s=n(i(/*! @babel/runtime/helpers/createClass */2)),a=(n(i(/*! ../models/player */15)),n(i(/*! ../consts/index */21))),r=function(){function t(e,i,n){(0,o.default)(this,t),this.max=20,this.born=1e3,this.timestamp=Date.now(),this.enemies=[{typeId:1,direction:"d",position:{x:10,y:10},targetPosition:{x:11,y:10},prevPosition:{x:10,y:10},mesh:null}],this.scene=e,this.camera=i,this.playerController=n}return(0,s.default)(t,[{key:"random",value:function(t){var e=Math.round(1e3*Math.random())%3;return{w:["w","a","d"],s:["s","d","a"],a:["a","s","w"],d:["d","w","s"]}[t][e]}},{key:"createEnemy",value:function(t){var e=["w","s","a","d"][Math.round(1e3*Math.random())%4],i=a.default.direction[e];return{typeId:1,position:{x:t.x,y:t.y},targetPosition:{x:t.x+i.x,y:t.y+i.y},prevPosition:{x:t.x,y:t.y},direction:e,mesh:null}}},{key:"calculate",value:function(){var t=this;if(Date.now()-this.timestamp>=this.born&&this.enemies.length<=this.max){this.timestamp=Date.now();var e={x:Math.round(Math.random()*a.default.gridCount)%a.default.gridCount-a.default.gridCount/2,y:Math.round(Math.random()*a.default.gridCount)%a.default.gridCount-a.default.gridCount/2},i=this.playerController.distance(e);if(this.playerController.outPath(e)&&this.playerController.outBlock(e)&&this.outEnemy(e)&&i>3&&i<=30){var n=this.createEnemy(e);this.enemies.push(n)}}var o=this;this.enemies.forEach(function(e){var i=new THREE.Vector2(e.position.x,e.position.y),n=new THREE.Vector2(e.targetPosition.x,e.targetPosition.y),s=new THREE.Vector2(e.prevPosition.x,e.prevPosition.y),r=i.distanceTo(n);if(r<=.02){var u=o.random(e.direction),l=a.default.direction[u],h={x:n.x+l.x,y:n.y+l.y};if(e.position={x:n.x,y:n.y},t.playerController.outBlock(h)&&r>3&&r<=50)e.prevPosition={x:n.x,y:n.y},e.targetPosition=h,e.direction=u;else{e.prevPosition={x:n.x,y:n.y},e.targetPosition={x:s.x,y:s.y},e.direction={w:"s",s:"w",a:"d",d:"a"}[e.direction]}}else e.position={x:i.x+(n.x-i.x)*a.default.enemyV,y:i.y+(n.y-i.y)*a.default.enemyV}})}},{key:"drawEnemies",value:function(){var t=this;this.enemies.filter(function(t){var e=null===t.mesh;return e||(t.mesh.position.x=t.position.x,t.mesh.position.y=t.position.y),e}).forEach(function(e){var i=new THREE.BoxGeometry(.2,.2,.2),n=new THREE.MeshBasicMaterial({color:"#99ff00",wireframe:!0}),o=new THREE.Mesh(i,n);o.position.x=e.position.x,o.position.y=e.position.y,o.position.z=.1,e.mesh=o,t.scene.add(e.mesh)})}},{key:"outEnemy",value:function(t){return 0===this.enemies.filter(function(e){return e.targetPosition.x===t.x&&e.targetPosition.y===t.y}).length}}]),t}();e.default=r},56:
/*!*****************************************************!*\
  !*** ./src/scripts/controllers/PlayerController.js ***!
  \*****************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,i){"use strict";var n=i(/*! @babel/runtime/helpers/interopRequireDefault */1);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i(/*! @babel/runtime/helpers/classCallCheck */3)),s=n(i(/*! @babel/runtime/helpers/createClass */2)),a=n(i(/*! ../models/player */15)),r=n(i(/*! ../consts/index */21));function u(t){var e=new THREE.BufferGeometry,i=[];return t.forEach(function(e,n){i=i.concat([e.x,e.y,e.z]),0!==n&&n!==t.length-1&&(i=i.concat([e.x,e.y,e.z]))}),e.addAttribute("position",new THREE.Float32BufferAttribute(i,3)),e}var l=function(){function t(e,i,n){(0,o.default)(this,t),this.direction="w",this.position={x:0,y:0},this.path=[{x:0,y:0,z:.01}],this.areas=[],this.blocks=[],this.scene=e,this.camera=i,this.gesture=n}return(0,s.default)(t,[{key:"init",value:function(){var t=new THREE.GridHelper(r.default.gridCount,r.default.gridCount,16777215,5592405);t.rotateOnAxis(new THREE.Vector3(1,0,0),Math.PI/180*90),this.scene.add(t);var e=new THREE.BoxGeometry(r.default.playerSize,r.default.playerSize,r.default.playerSize),i=new THREE.MeshNormalMaterial;this.mesh=new THREE.Mesh(e,i),this.mesh.position.z=r.default.playerSize/2,this.scene.add(this.mesh)}},{key:"addBlocks",value:function(t){this.blocks.forEach(function(e){var i=t.findIndex(function(t){return t.point1.x===e.point1.x&&t.point1.y===e.point1.y});-1!==i&&t.splice(i,1)}),this.blocks=this.blocks.concat(t),console.log("this.blocks",this.blocks)}},{key:"addArea",value:function(t){var e={points:t,mesh:null},i=e.points[0],n=i.x,o=i.y,s=i.x,a=i.y;e.points.forEach(function(t){t.x>n&&(n=t.x),t.y>o&&(o=t.y),t.x<s&&(s=t.x),t.y<a&&(a=t.y)});for(var r=[],u=e.points.length,l=s;l<=n;l++)for(var h=-1,d=o;d>a;d--){var c={point1:{x:l,y:d},point2:{x:l+1,y:d},point3:{x:l+1,y:d+1},point4:{x:l,y:d+1},mesh:null};1===e.points.filter(function(t,i){var n=e.points[(u+i-1)%u],o=e.points[(u+i+1)%u];return c.point1.x===t.x&&c.point1.y===t.y&&(c.point2.x===n.x&&c.point2.y===n.y||c.point2.x===o.x&&c.point2.y===o.y)}).length&&(h+=1),h%2==0&&r.push(c)}console.log("blocks",r),this.addBlocks(r),this.areas.push(e)}},{key:"drawArea",value:function(){var t=this;this.areas.filter(function(t){return null===t.mesh}).forEach(function(e){var i=new THREE.Shape;e.points.forEach(function(t,e){0===e?i.moveTo(t.x,t.y):i.lineTo(t.x,t.y)});var n=new THREE.ShapeGeometry(i),o=new THREE.MeshBasicMaterial({color:16770714});e.mesh=new THREE.Mesh(n,o),e.mesh.position.set(0,0,.02),t.scene.add(e.mesh)})}},{key:"calculate",value:function(){if(Math.sqrt(Math.pow(a.default.position.x-this.position.x,2)+Math.pow(a.default.position.y-this.position.y,2))>=1){this.gestureDirection();var t=a.default.direction===this.direction;a.default.position={x:Math.round(this.position.x),y:Math.round(this.position.y)},t||(a.default.direction=this.direction,this.position={x:a.default.position.x,y:a.default.position.y});var e=this.path.findIndex(function(t){return t.x===a.default.position.x&&t.y===a.default.position.y});if(-1!==e){var i=this.path.splice(e+1,this.path.length-e);i.push({x:a.default.position.x,y:a.default.position.y,z:.01}),i.length>=4&&(this.addArea(i),this.path=[{x:a.default.position.x,y:a.default.position.y,z:.01}])}else this.path.push({x:a.default.position.x,y:a.default.position.y,z:.01});console.log(a.default.position,this.path)}}},{key:"random",value:function(){var t=Math.round(1e3*Math.random())%3,e={w:["w","a","d"],s:["s","d","a"],a:["a","s","w"],d:["d","w","s"]}[this.direction][t];this.direction=e}},{key:"gestureDirection",value:function(){"c"!==this.gesture.direction&&(this.direction=this.gesture.direction,this.gesture.direction="c")}},{key:"applyMesh",value:function(){this.mesh.position.x=this.position.x,this.mesh.position.y=this.position.y}},{key:"applyCamera",value:function(){this.camera.position.x=this.position.x-15,this.camera.position.y=this.position.y-15,this.camera.position.z=15*Math.sqrt(3)/2,this.camera.up=new THREE.Vector3(.5,.5,0),this.camera.lookAt(this.position.x,this.position.y,0)}},{key:"update",value:function(){var t=r.default.direction[a.default.direction];this.mesh.position.x+=t.x*r.default.playerV,this.mesh.position.y+=t.y*r.default.playerV,this.position.x=this.mesh.position.x,this.position.y=this.mesh.position.y}},{key:"drawPath",value:function(){this.path.length>1?(this.pathMesh?(this.pathMesh.geometry=u(this.path),this.pathMesh.computeLineDistances()):(this.pathMesh=new THREE.LineSegments(u(this.path),new THREE.LineDashedMaterial({color:16755200,dashSize:.3,gapSize:.1,linewidth:2})),this.pathMesh.computeLineDistances(),this.scene.add(this.pathMesh)),this.pathMesh.visible=!0):this.pathMesh&&(this.pathMesh.visible=!1)}},{key:"outBlock",value:function(t){return 0===this.blocks.filter(function(e){return e.point1.x===t.x&&e.point1.y===t.y||e.point3.x===t.x&&e.point3.y===t.y}).length}},{key:"distance",value:function(t){return Math.sqrt(Math.pow(this.position.x-t.x,2)+Math.pow(this.position.y-t.y,2))}},{key:"outPath",value:function(t){return 0===this.path.filter(function(e){return e.x===t.x&&e.y===t.y}).length}}]),t}();e.default=l},57:
/*!******************************************************!*\
  !*** ./src/scripts/controllers/DebugUIController.js ***!
  \******************************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,i){"use strict";var n=i(/*! @babel/runtime/helpers/interopRequireDefault */1);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i(/*! @babel/runtime/helpers/classCallCheck */3)),s=n(i(/*! @babel/runtime/helpers/createClass */2)),a=n(i(/*! ../models/player */15)),r={w:"北",d:"东",a:"西",s:"南",c:"保持当前方向"},u=function(){function t(e,i,n){(0,o.default)(this,t),this.enemyController=i,this.playerController=e,this.gestureController=n,this.dom=document.createElement("div")}return(0,s.default)(t,[{key:"init",value:function(){this.dom.style.position="absolute",this.dom.style.top=0,this.dom.style.right=0,this.dom.style.padding="10px",this.dom.style.backgroundColor="rgba(255,255,255,0.3)",this.dom.style.color="rgb(255,255,255)",document.body.appendChild(this.dom)}},{key:"update",value:function(){this.dom.innerText=["敌人数量:"+this.enemyController.enemies.length+"个","圈地数量:"+this.playerController.blocks.length+"格","当前行驶方向:"+r[a.default.direction],"准备切换方向:"+r[this.gestureController.direction]].join("\n")}}]),t}();e.default=u},58:
/*!**********************************!*\
  !*** ./src/scenes/play/index.js ***!
  \**********************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,i){"use strict";var n=i(/*! @babel/runtime/helpers/interopRequireDefault */1);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i(/*! @babel/runtime/core-js/object/get-prototype-of */38)),s=n(i(/*! @babel/runtime/helpers/classCallCheck */3)),a=n(i(/*! @babel/runtime/helpers/createClass */2)),r=n(i(/*! @babel/runtime/helpers/possibleConstructorReturn */32)),u=n(i(/*! @babel/runtime/helpers/inherits */22)),l=(n(i(/*! ../../scripts/models/player */15)),n(i(/*! ../../scripts/consts/index */21)),n(i(/*! ../scene */16))),h=n(i(/*! ../../scripts/controllers/DebugUIController */57)),d=n(i(/*! ../../scripts/controllers/PlayerController */56)),c=n(i(/*! ../../scripts/controllers/EnemyController */55)),f=n(i(/*! ../../scripts/controllers/GestureController */54)),p=function(t){function e(){return(0,s.default)(this,e),(0,r.default)(this,(e.__proto__||(0,o.default)(e)).apply(this,arguments))}return(0,u.default)(e,t),(0,a.default)(e,[{key:"Start",value:function(){var t=10*(window.innerWidth/window.innerHeight);this.camera=new THREE.OrthographicCamera(t/-2,t/2,5,-5,1,100),this.camera.position.z=10,this.gestureController=new f.default,this.playerController=new d.default(this.scene,this.camera,this.gestureController),this.enemyController=new c.default(this.scene,this.camera,this.playerController),this.uiController=new h.default(this.playerController,this.enemyController,this.gestureController),this.playerController.init(),this.uiController.init(),this.gestureController.init()}},{key:"Update",value:function(){this.playerController.update(),this.playerController.calculate(),this.playerController.applyMesh(),this.playerController.applyCamera(),this.playerController.drawPath(),this.playerController.drawArea(),this.enemyController.calculate(),this.enemyController.drawEnemies(),this.uiController.update()}},{key:"End",value:function(){this.gestureController.unload()}}]),e}(l.default);e.default=p},59:
/*!*************************************!*\
  !*** ./src/scenes/loading/index.js ***!
  \*************************************/
/*! no static exports found */
/*! all exports used */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,i){"use strict";var n=i(/*! @babel/runtime/helpers/interopRequireDefault */1);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i(/*! @babel/runtime/core-js/object/get-prototype-of */38)),s=n(i(/*! @babel/runtime/helpers/classCallCheck */3)),a=n(i(/*! @babel/runtime/helpers/createClass */2)),r=n(i(/*! @babel/runtime/helpers/possibleConstructorReturn */32)),u=n(i(/*! @babel/runtime/helpers/inherits */22)),l=function(t){function e(){return(0,s.default)(this,e),(0,r.default)(this,(e.__proto__||(0,o.default)(e)).apply(this,arguments))}return(0,u.default)(e,t),(0,a.default)(e,[{key:"Start",value:function(){}},{key:"Update",value:function(){}},{key:"End",value:function(){}}]),e}(n(i(/*! ../scene */16)).default);e.default=l}},[[107,0,1]]]);